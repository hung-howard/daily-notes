var b=Object.defineProperty;var E=(o,e,t)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>E(o,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const d={notes:[]};console.log(d);const L=function(o,e="item"){return{id:Date.now(),text:o,isEditing:!1,type:e,checked:!1}},_=function(){localStorage.setItem("notes",JSON.stringify(d.notes))},y=function(o){if(typeof o=="object")d.notes.push({...o,type:"title",checked:!1});else{const e=L(o,"item");d.notes.push(e)}_()},S=function(o){const e=d.notes.findIndex(t=>t.id===o);e>-1&&(d.notes.splice(e,1),_())},k=function(o,e){const t=d.notes.find(s=>s.id===o);t&&(t.text=e,t.isEditing=!1,_())},q=function(o,e){const[t]=d.notes.splice(o,1);d.notes.splice(e,0,t),_()},x=function(o){const e=d.notes.find(t=>t.id===o);e&&(e.checked=!e.checked,_())},I=function(){const o=localStorage.getItem("notes");o&&(d.notes=JSON.parse(o))};I();class N{constructor(){r(this,"_parentElement",document.querySelector(".draggable__title-list"));r(this,"_addBtn",document.querySelector(".addItemBtn"));r(this,"_addInput",document.querySelector(".addItem__input"));r(this,"_titleBtn",document.querySelector(".addNewTitle"));r(this,"_overlay",document.querySelector(".overlay"));r(this,"_draggedItem",null);document.addEventListener("keydown",e=>{if(e.key==="Escape"){const t=this._parentElement.querySelector(".editing");t&&this.handleCancelEdit(t)}}),document.addEventListener("click",e=>{e.target.closest(".todo__title")||this._parentElement.querySelectorAll(".item.titleFocus").forEach(n=>{const i=n.closest(".todo__title");if(i&&!i.classList.contains("editing")){n.classList.remove("titleFocus");const a=n.querySelector(".title-input");a&&(a.disabled=!0)}})}),this._addDragListeners()}addHandlerAddItem(e){this._addBtn.addEventListener("click",t=>{t.preventDefault();const s=this._addInput.value.trim();s&&(e(s),this._addInput.value="")}),this._addInput.addEventListener("keydown",t=>{if(t.key==="Enter"){const s=this._addInput.value.trim();if(!s)return;e(s),this._addInput.value=""}})}addHandlerAddTitle(e){this._titleBtn.addEventListener("click",t=>{t.preventDefault();const s={id:Date.now(),text:"",isEditing:!0};e(s)})}handleConfirm(e,t){const s=Number(e.dataset.id),n=e.classList.contains("todo__title")?e.querySelector(".title-input"):e.querySelector(".todo-input"),i=e.querySelector(".btn__container"),a=e.querySelector(".checkbtn"),l=(e.classList.contains("todo__title"),n.value.trim());l&&(e.classList.contains("todo__title"),n.disabled=!0,e.classList.remove("editing"),e.setAttribute("draggable","true"),i.style.display="",a.style.display="",a.classList.add("hidden"),this._overlay.classList.add("hidden"),this._addInput.addEventListener("keydown",u=>{if(u.key==="Enter"){const h=this._addInput.value.trim();if(!h)return;t(h),this._addInput.value=""}}),t(s,l))}handleCancelEdit(e){const t=e.classList.contains("todo__title")?e.querySelector(".title-input"):e.querySelector(".todo-input"),s=e.querySelector(".btn__container"),n=e.querySelector(".checkbtn");if(e.classList.contains("todo__title")){t.disabled=!0;const i=e.querySelector(".item");i&&i.classList.remove("titleFocus")}else t.disabled=!0,e.querySelector(".todo__detail").classList.remove("focus");e.classList.remove("editing"),e.setAttribute("draggable","true"),s.style.display="",n.style.display="",n.classList.add("hidden"),this._overlay.classList.add("hidden")}handleEdit(e){const t=e.classList.contains("todo__title")?e.querySelector(".title-input"):e.querySelector(".todo-input"),s=e.querySelector(".btn__container"),n=e.querySelector(".checkbtn"),i=e.querySelector(".item"),a=e.querySelector('input[type="checkbox');a&&(a.disabled=!0),e.classList.contains("todo__title")?i.classList.add("titleFocus"):e.querySelector(".todo__detail").classList.add("focus"),e.classList.add("editing"),e.setAttribute("draggable","false"),s.style.display="none",n.style.display="block",n.classList.remove("hidden"),e.classList.contains("todo__title")?(t.disabled=!1,t.focus()):(t.disabled=!1,t.focus(),t.select()),this._overlay.classList.remove("hidden"),this._overlay.addEventListener("click",l=>{l.preventDefault();const u=this._parentElement.querySelector(".editing");u&&this.handleCancelEdit(u)},{once:!0})}addHandlerEdit(e){this._parentElement.addEventListener("click",t=>{t.preventDefault();const s=t.target.closest(".fa-pen, .checkbtn");if(!s)return;const n=s.closest(".todo, .todo__title");n&&(s.classList.contains("checkbtn")?this.handleConfirm(n,e):this.handleEdit(n))})}addHandlerDelete(e){this._parentElement.addEventListener("click",t=>{t.preventDefault();const s=t.target.closest(".fa-trash");if(!s)return;const n=s.closest(".todo, .todo__title"),i=Number(n.dataset.id);e(i)})}_generateMarkup(e){return e.type==="title"?`
        <li class="todo__title ${e.isEditing?"editing":""}" 
            draggable="true" 
            data-id=${e.id}>
          <span class="fa-solid fa-grip-vertical"></span>
          <div class="item ${e.isEditing?"titleFocus":""}">
            <input 
              type="text" 
              class="title-input"
              value="${e.text}"
              placeholder="輸入標題..."
              autocomplete="off"
              ${e.isEditing?"":"disabled"}
            />
            <div class="btn__container">
              <button class="fa-solid fa-pen"></button>
              <button class="fa-solid fa-trash"></button>
            </div>
            <button class="fa-solid fa-check checkbtn ${e.isEditing?"":"hidden"}"></button>
          </div>
        </li>
      `:`
        <li class="todo" draggable="true" data-id=${e.id}>
          <span class="fa-solid fa-grip-vertical"></span>
          <div class="todo__detail">
            <input 
              type="checkbox" 
              ${e.checked&&"checked"}
            >
            <input 
              type="text" 
              class="todo-input ${e.checked?"done":""}" 
              value="${e.text}"
              disabled
            />
            <div class="btn__container">
              <button class="fa-solid fa-pen"></button>
              <button class="fa-solid fa-trash"></button>
            </div>
            <button class="fa-solid fa-check checkbtn hidden"></button>
          </div>
        </li>
      `}render(e){const s=e.filter(i=>!i.checked||i.type==="title").map(this._generateMarkup).join("");this._parentElement.innerHTML=s;const n=this._parentElement.querySelector(".todo__title.editing");if(n){const i=n.querySelector(".title-input"),a=n.querySelector(".item"),l=n.querySelector(".btn__container"),u=n.querySelector(".checkbtn");i&&(i.disabled=!1,i.focus()),a&&a.classList.add("titleFocus"),l&&(l.style.display="none"),u&&(u.style.display="block",u.classList.remove("hidden")),this._overlay.classList.remove("hidden")}}addHandlerReorder(e){this._parentElement.addEventListener("reorder",t=>{e(t.detail.fromIndex,t.detail.toIndex)})}_addDragListeners(){this._parentElement&&(this._parentElement.addEventListener("dragstart",this._handleDragStart.bind(this)),this._parentElement.addEventListener("dragend",this._handleDragEnd.bind(this)),this._parentElement.addEventListener("dragover",this._handleDragOver.bind(this)),this._parentElement.addEventListener("drop",this._handleDrop.bind(this)))}_handleDragStart(e){const t=e.target.closest("li");if(!t||t.classList.contains("editing")){e.preventDefault();return}this._draggedItem=t,t.classList.add("draggable"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain","")}_handleDragEnd(e){this._draggedItem&&(this._draggedItem.classList.remove("draggable"),this._parentElement.querySelectorAll("li").forEach(t=>{t.style.borderTop="",t.style.borderBottom=""}))}_handleDragOver(e){e.preventDefault();const t=e.target.closest("li");if(!t||t===this._draggedItem)return;const s=t.getBoundingClientRect(),n=e.clientY-s.top,i=s.height;n<i/2?(t.style.borderTop="1px solid var(--color-grey-600)",t.style.borderBottom=""):(t.style.borderBottom="1px solid var(--color-grey-600)",t.style.borderTop="")}_handleDrop(e){e.preventDefault();const t=e.target.closest("li");if(!t||!this._draggedItem)return;const s=t.getBoundingClientRect(),n=e.clientY-s.top,i=s.height,a=n>i/2,l=Array.from(this._parentElement.children),u=l.indexOf(this._draggedItem);let h=l.indexOf(t);if(a&&h++,u!==h){this._parentElement.insertBefore(this._draggedItem,h<l.length?l[h]:null);const p=new CustomEvent("reorder",{detail:{fromIndex:u,toIndex:h}});this._parentElement.dispatchEvent(p)}this._parentElement.querySelectorAll("li").forEach(p=>{p.style.borderTop="",p.style.borderBottom=""})}addHandlerToggle(e){this._parentElement.addEventListener("click",t=>{const s=t.target.closest('input[type="checkbox"]');if(!s)return;t.stopPropagation();const n=s.closest(".todo");if(!n)return;const i=Number(n.dataset.id),a=n.querySelector(".todo-input");s.checked?a.classList.add("done"):a.classList.remove("done"),e(i)})}addHandleToggle(e){this._parentElement.addEventListener("click",t=>{const s=t.target.closest("input");if(!s)return;t.stopPropagation();const n=s.closest(".todo");if(!n)return;const i=Number(n.dataset.id);e(i)})}}const c=new N;class T{constructor(){r(this,"_parentElement",document.querySelector(".finish__container"));r(this,"_progressBar",document.querySelector("#progressBar"));r(this,"_progressText",document.querySelector(".progressBar__text p:last-child"))}render(e){const s=e.filter(n=>n.checked).map(this.generateMarkup).join("");this._parentElement.innerHTML=s,this.updateProgress(e)}generateMarkup(e){return`
         <li class="finish__item" data-id = ${e.id}>
            <label class="done">${e.text}</label>
             <div>
                <button class="fas fa-rotate-left resetBtn" />
             </div>
          </li>
    `}updateProgress(e){const t=e.filter(i=>i.type==="item").length,s=e.filter(i=>i.checked).length,n=t===0?0:s/t*100;this._progressBar.value=n,this._progressText.textContent=`${s}/${t}`}addHandlerReset(e){this._parentElement.addEventListener("click",t=>{const s=t.target.closest(".resetBtn");if(!s)return;const n=s.closest(".finish__item");if(!n)return;const i=+n.dataset.id;e(i)})}}const f=new T;class D{constructor(){r(this,"_closeBtn",document.querySelector(".xmark"));r(this,"_reviewBtn",document.querySelector(".reviewBtn"));r(this,"_parentElement",document.querySelector(".finish__List"));r(this,"_date",document.querySelector(".date"));this._dialog=document.querySelector("dialog"),this._setDate(),this._dialog.addEventListener("click",e=>{const t=this._dialog.getBoundingClientRect();(e.clientX<t.left||e.clientX>t.right||e.clientY<t.top||e.clientY>t.bottom)&&this._dialog.close()})}_setDate(){this._parentElement.innerHTML="";const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");this._date.textContent=`${t}/${s}/${n}`}addHandlerOpen(e){this._reviewBtn.addEventListener("click",()=>{this._dialog.showModal(),this.render(e)})}addHandlerClose(){this._closeBtn.addEventListener("click",()=>{this._dialog.close(),this._parentElement.innerHTML=""})}_generateMarkup(e){return`
         <li class="finish__note" >
                <i class="fa-solid fa-circle"></i>
                <p>${e.text}</p>
              </li>
    `}render(e){if(!e)return;this._parentElement.innerHTML="";const s=e.filter(n=>n.checked).map(n=>this._generateMarkup(n)).join("");this._parentElement.insertAdjacentHTML("afterbegin",s)}}const g=new D;class w{constructor(){r(this,"_todoSection",document.querySelector(".task__container"));r(this,"_dailyNoteSection",document.querySelector(".dailyNote"));r(this,"_switchTabs",document.querySelector(".switch-tabs"));r(this,"_tabs",document.querySelectorAll(".tab"));this._initializeView()}_initializeView(){this._todoSection.classList.remove("hidden"),this._dailyNoteSection.classList.add("hidden"),this._tabs.forEach(e=>{e.textContent==="待辦事項"?e.classList.add("active"):e.classList.remove("active")})}addHandlerToggle(e){this._switchTabs.addEventListener("click",e)}toggleSections(e){this._tabs.forEach(t=>t.classList.remove("active")),e.classList.add("active"),e.textContent==="待辦事項"?(this._dailyNoteSection.classList.add("hidden"),this._todoSection.classList.remove("hidden")):e.textContent==="每日回顧"&&(this._todoSection.classList.add("hidden"),this._dailyNoteSection.classList.remove("hidden"))}}const v=new w;class C{constructor(){r(this,"_parentElement",document.querySelector(".switch-tabs"));r(this,"_tabs",document.querySelectorAll(".tab"));r(this,"_taskContainer",document.querySelector(".task__container"));r(this,"_dailyNote",document.querySelector(".dailyNote"));this._addHandlerTabChange()}_addHandlerTabChange(){this._tabs.forEach((e,t)=>{e.addEventListener("click",()=>{this._tabs.forEach(s=>s.classList.remove("active")),e.classList.add("active"),t===1?(this._parentElement.classList.add("slide-right"),this._taskContainer.classList.add("hidden"),this._dailyNote.classList.remove("hidden")):(this._parentElement.classList.remove("slide-right"),this._taskContainer.classList.remove("hidden"),this._dailyNote.classList.add("hidden"))})})}}new C;const B=function(o){y(o),c.render(d.notes),f.render(d.notes)},H=function(o){y(o),c.render(d.notes),f.render(d.notes)},$=function(o){S(o),c.render(d.notes)},A=function(o,e){k(o,e),c.render(d.notes)},M=function(o,e){q(o,e)},m=function(o){x(o),c.render(d.notes),f.render(d.notes)},O=function(){g.addHandlerOpen(d.notes),g.addHandlerClose()},F=function(o){const e=o.target.closest(".tab");e&&v.toggleSections(e)},P=function(){f.render(d.notes),f.addHandlerReset(m),c.render(d.notes),c.addHandlerAddItem(B),c.addHandlerDelete($),c.addHandlerEdit(A),c.addHandlerAddTitle(H),c.addHandlerReorder(M),c.addHandleToggle(m),v.addHandlerToggle(F),O()};P();
